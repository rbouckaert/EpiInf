#+TITLE: Conditional Sampling Validation
#+AUTHOR: Tim

* Validation strategy
  
In order to ensure that the conditioned sampling tree prior is
correct, we directly simulate trees under the conditioned sampling
model and compare this distribution to that obtained using our
particle filter-based tree prior via MCMC.

In particular, we use the script directSimulation.xml (found in the
validation/ConditionedSampling directory of the EpiInf repository) to
simulate $10^5$ trees, each with 5 leaves sampled at times 6, 7, 8, 9
and 10 following the start of a linear BD process.  The birth rate is
set to 1.05 and the death rate to 1.  (This small difference in rates
means that the simulated population size rarely becomes unmanageable.)
In this initial test we fix the removal probability to 1, meaning that
the distribution should have no ``sampled ancestor'' nodes.

We then use the script mcmc.xml (found in the same directory) to
sample trees from the same distribution using the particle MCMC
algorithm.

First, let's load the results of the analyses:

#+BEGIN_SRC R :session
df_direct <- read.table("directSimulation.log", header=T, sep="\t")
df_mcmc <- read.table("mcmc.log", header=T, sep="\t")[-(1:100),]
#+END_SRC

#+RESULTS:

We wll now compare the distributions obtained.

* Tree Height
  
The following compares the distributions of tree heights obtained,
demonstrating agreement between the methods.
  
#+BEGIN_SRC R :session :file th_compare.png :results graphics :exports both
  th_direct <- hist(df_direct$tree.height, breaks=seq(4,10,length.out=20))
  th_mcmc <- hist(df_mcmc$tree.height, breaks=seq(4,10,length.out=20))

  plot(th_direct$mids, th_direct$density, 'l', col='red',
       main="Tree height comparison", xlab="Tree Height", ylab="Density")
  lines(th_mcmc$mids, th_mcmc$density, 'l', col='blue')

  legend('bottomright', inset=0.05, c("Direct Simulation", "MCMC"),
         col=c("red","blue"), lty=1)
#+END_SRC

#+RESULTS:
[[file:th_compare.png]]

* Tree Length
  
The following compares the distributions of tree lengths (total edge
length) generated by the different methods.  These also seem to agree
nicely.

#+BEGIN_SRC R :session :file tl_compare.png :results graphics :exports both
  tl_direct <- hist(df_direct$tree.treeLength, breaks=seq(0,40,length.out=20))
  tl_mcmc <- hist(df_mcmc$tree.treeLength, breaks=seq(0,40,length.out=20))

  plot(tl_direct$mids, tl_direct$density, 'l', col='red',
       main="Tree length comparison", xlab="Tree Length", ylab="Density")
  lines(tl_mcmc$mids, tl_mcmc$density, 'l', col='blue')

  legend('topright', inset=0.05, c("Direct Simulation", "MCMC"),
         col=c("red","blue"), lty=1)
#+END_SRC

#+RESULTS:
[[file:tl_compare.png]]
